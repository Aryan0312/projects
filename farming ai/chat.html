<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Krishi Sakhi â€” AI Chatbot</title>
  <style>
    :root {
      --accent:#1e8f6e;
      --bg:#f6fbf8;
      --card:#ffffff;
      --muted:#6b7280;
      font-family: Inter, system-ui, -apple-system, "Helvetica Neue", Arial;
    }
    body {
      margin:0;
      display:flex;
      flex-direction:column;
      height:100vh;
      background:var(--bg);
    }
    header {
      background:var(--accent);
      color:white;
      padding:14px 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    header h1 {margin:0;font-size:20px}
    nav a {color:white;text-decoration:none;margin-left:16px;font-weight:600}

    .chat-container {
      flex:1;
      overflow-y:auto;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .msg {
      max-width:70%;
      padding:12px;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      word-wrap:break-word;
    }
    .farmer {background:var(--card);align-self:flex-start}
    .ai {background:var(--accent);color:white;align-self:flex-end}
    .input-area {
      display:flex;
      align-items:center;
      gap:8px;
      padding:12px;
      background:var(--card);
      box-shadow:0 -2px 6px rgba(0,0,0,0.1);
    }
    input[type="text"] {
      flex:1;
      padding:10px;
      border:1px solid #ddd;
      border-radius:8px;
    }
    button, label.upload {
      background:var(--accent);
      border:none;
      color:white;
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition: opacity 0.3s ease;
    }
    button.mute {background:#e03d3d}
    input[type="file"] {display:none}
    label.upload.disabled, button.disabled {
      opacity:0.5;
      cursor:not-allowed;
      pointer-events:none;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ¤– Krishi Sakhi Chatbot</h1>
    <nav>
      <a href="home.html">ğŸ  Home</a>
    </nav>
  </header>

  <div class="chat-container" id="chatBox">
    <div class="msg ai">Hello ğŸ‘‹! Iâ€™m your farming assistant. How can I help you today?</div>
  </div>

  <div class="input-area">
    <input type="text" id="userInput" placeholder="Type your question...">
    <button id="micBtn" onclick="startVoice()">ğŸ¤</button>
    <label for="photoUpload" class="upload" id="camBtn">ğŸ“·</label>
    <input type="file" id="photoUpload" accept="image/*">
    <button onclick="sendMessage()">Send</button>
    <button class="mute" onclick="toggleMute()">ğŸ”‡</button>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const photoUpload = document.getElementById("photoUpload");
    const micBtn = document.getElementById("micBtn");
    const camBtn = document.getElementById("camBtn");

    let speaking = false; 
    let recognition;
    let currentLang = "en-IN"; // Default language

    // ğŸ”’ Disable mic & cam
    function lockControls() {
      micBtn.classList.add("disabled");
      camBtn.classList.add("disabled");
    }
    // ğŸ”“ Enable mic & cam
    function unlockControls() {
      micBtn.classList.remove("disabled");
      camBtn.classList.remove("disabled");
    }

    // ğŸ“’ Add messages
    function addMessage(text, sender="farmer") {
      const div = document.createElement("div");
      div.className = `msg ${sender}`;
      div.textContent = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;

      if(sender === "ai") {
        lockControls();
        speaking = true;
        speakText(text, currentLang);
      }
    }

    // ğŸ¤ Voice input
    function startVoice() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Speech recognition not supported");
        return;
      }
      lockControls();
      recognition = new webkitSpeechRecognition();
      recognition.lang = currentLang;
      recognition.start();
      recognition.onresult = function(event) {
        userInput.value = event.results[0][0].transcript;
      }
      recognition.onend = function() {
        unlockControls();
      }
    }

    // ğŸ”Š TTS
    function speakText(text, lang) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = lang;
      utter.onend = () => {
        speaking = false;
        unlockControls();
      };
      speechSynthesis.speak(utter);
    }

    // ğŸ”‡ Mute
    function toggleMute() {
      speaking = false;
      speechSynthesis.cancel();
      unlockControls();
    }

    // ğŸ“· Photo upload
    photoUpload.addEventListener("change", () => {
      const file = photoUpload.files[0];
      if(file) {
        const div = document.createElement("div");
        div.className = "msg farmer";
        const img = document.createElement("img");
        img.src = URL.createObjectURL(file);
        img.style.maxWidth = "200px";
        img.style.borderRadius = "8px";
        div.appendChild(img);
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    });

    // ğŸš€ Send message
    function sendMessage() {
      const text = userInput.value.trim();
      if(!text) return;
      addMessage(text,"farmer");
      userInput.value = "";

      // Fake AI response (replace with API later)
      setTimeout(() => {
        addMessage("Hereâ€™s an advisory based on your input ğŸŒ±","ai");
      },1000);
    }
  </script>
</body>
</html>
